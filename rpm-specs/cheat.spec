# Generated by go2rpm 1.10.0
%bcond_without check

%global sheets_commit 36bdb99dcfadde210503d8c2dcf94b34ee950e1d
%global sheets_commit_short 36bdb99

# https://github.com/cheat/cheat
%global goipath         github.com/cheat/cheat
Version:                4.4.2
%global tag             4.4.2

%gometa -L -f

%global common_description %{expand:
Cheat allows you to create and view interactive cheatsheets on the command-
line. It was designed to help remind *nix system administrators of options for
commands that they use frequently, but not frequently enough to remember.}

%global golicenses      LICENSE.txt
%global godocs          doc CONTRIBUTING.md HACKING.md INSTALLING.md\\\
                        README.md cmd/cheat/docopt.txt

Name:           cheat
Release:        %autorelease
Summary:        Help for various commands and their use cases

License:        MIT
URL:            %{gourl}
Source:         %{gosource}
Source:         https://github.com/cheat/cheatsheets/archive/%{sheets_commit_short}.tar.gz
Source:         cheat-config-FEDORA.yml
# For tests a default editor is required
BuildRequires:  nano-default-editor

Recommends:     cheat-community-cheatsheets


%description %{common_description}

# We wont use full versioned dependency because rpmdiff then complains about
# difference between noarch subpackages on different architectures
%package bash-completion
Summary: Bash completion support for %{name}
BuildArch: noarch
Requires: %{name} = %{version}-%{release}
Requires: bash bash-completion

%description bash-completion
Files needed to support bash completion.

%package fish-completion
Summary: Fish completion support for %{name}
BuildArch: noarch
Requires: %{name} = %{version}-%{release}
Requires: fish

%description fish-completion
Files needed to support fish completion.

%package zsh-completion
Summary: Zsh completion support for %{name}
BuildArch: noarch
Requires: %{name} = %{version}-%{release}
Requires: zsh

%description zsh-completion
Files needed to support zsh completion.

%package community-cheatsheets
Summary:   Cheatsheets created by community for %{name}
URL:       https://github.com/cheat/cheatsheets
License:   CC0-1.0
BuildArch: noarch
Requires:  %{name} = %{version}-%{release}
Supplements:  cheat

%description community-cheatsheets
Cheatsheets for various programs created and maintained by the
community.

%gopkg

%prep
%goprep -A
%autopatch -p1

tar -xf %{SOURCE1}

%generate_buildrequires
%go_generate_buildrequires

%build
%gobuild -o %{gobuilddir}/bin/cheat %{goipath}/cmd/cheat

%install
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

install -Dm 0644 -p scripts/cheat.bash %{buildroot}%{bash_completions_dir}/cheat
install -Dm 0644 -p scripts/cheat.fish %{buildroot}%{fish_completions_dir}/cheat.fish
install -Dm 0644 -p scripts/cheat.zsh  %{buildroot}%{zsh_completions_dir}/_cheat

# Install cheatsheets
mkdir -m 0755 -p %{buildroot}/%{_datadir}/cheat
mkdir -m 0755 -p %{buildroot}/%{_datadir}/cheat/vim-plugins

for sheet in `find cheatsheets-%{sheets_commit}/ -maxdepth 1 -type f`; do
  install -m 0644 -p $sheet %{buildroot}%{_datadir}/cheat/
done

for sheet in `find cheatsheets-%{sheets_commit}/vim-plugins/ -maxdepth 1 -type f`; do
  install -m 0644 -p $sheet %{buildroot}%{_datadir}/cheat/
done

mkdir -m 0755 -p %{buildroot}%{_sysconfdir}/cheat
install -m 0644 -p %{SOURCE2} %{buildroot}%{_sysconfdir}/cheat/conf.yml

%if %{with check}
%check
%gocheck
%endif

%files
%license LICENSE.txt
%doc doc CONTRIBUTING.md HACKING.md INSTALLING.md README.md cmd/cheat/docopt.txt
%config(noreplace) %{_sysconfdir}/cheat/conf.yml
%{_bindir}/cheat

%files community-cheatsheets
%license cheatsheets-%{sheets_commit}/.github/LICENSE.txt
%{_datadir}/cheat/

%files bash-completion
%{bash_completions_dir}/cheat

%files fish-completion
%{fish_completions_dir}/cheat.fish

%files zsh-completion
%{zsh_completions_dir}/_cheat

%changelog
%autochangelog
