# Generated by go2rpm 1.9.0
%bcond_without check

# https://github.com/nilslice/protolock
%global goipath         github.com/nilslice/protolock
Version:                0.16.0

%gometa -f


%global common_description %{expand:
Protocol Buffer companion tool. Track your .proto files and prevent changes to
messages and services which impact API compatibility.}

%global golicenses      LICENSE
%global godocs          README.md

Name:           %{goname}
Release:        %autorelease
Summary:        Protocol Buffer companion tool

License:        BSD-3-Clause
URL:            %{gourl}
Source:         %{gosource}

%description %{common_description}

%package -n     protolock
Summary:        %{summary}

%description -n protolock %{common_description}

%gopkg

%prep
%goprep
%autopatch -p1

%generate_buildrequires
%go_generate_buildrequires

%build
%if 0%{?el9}
export GOPATH="%{gobuilddir}:%{gopath}"
export GO111MODULE=off
%endif
%gobuild -o %{gobuilddir}/bin/protolock %{goipath}/cmd/protolock

%install
%gopkginstall
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

%if %{with check}
%check
# TestOrder is broken: https://github.com/nilslice/protolock/issues/147
rm order_test.go
%gocheck
%endif

%files -n protolock
%license LICENSE
%doc README.md
%{_bindir}/protolock

%gopkgfiles

%changelog
%autochangelog
