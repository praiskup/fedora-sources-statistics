# Generated by go2rpm
%bcond_without check

%global debug_package %{nil}

# https://github.com/oschwald/geoip2-golang
%global goipath         github.com/oschwald/geoip2-golang
Version:                1.4.0
# test data for the non-exported git submodule
%global dataurl         https://github.com/maxmind/MaxMind-DB
%global dataref         13c25fcb6f50fdd0ec8286b4d540a45a20e28b0d

%gometa

# Remove in F33
%global godevelheader %{expand:
Obsoletes:      golang-github-oschwald-geoip2-golang-devel < 1.3.0-2
}

%global common_description %{expand:
This library reads MaxMind GeoLite2 and GeoIP2 databases.

This library is built using the Go maxminddb reader. All data for the database
record is decoded using this library. If you only need several fields, you may
get superior performance by using maxminddb's Lookup directly with a result
struct that only contains the required fields. (See example_test.go in the
maxminddb repository for an example of this.)}

%global golicenses      LICENSE test-data/LICENSE
%global godocs          README.md

Name:           %{goname}
Release:        %autorelease
Summary:        Unofficial MaxMind GeoIP2 Reader for Go

# Code: ISC; Test data: CC-BY-SA 3.0
# Automatically converted from old format: ISC and CC-BY-SA - review is highly recommended.
License:        ISC AND LicenseRef-Callaway-CC-BY-SA
URL:            %{gourl}
Source0:        %{gosource}
Source1:        %{dataurl}/archive/%{dataref}/MaxMind-DB-%{dataref}.tar.gz

BuildRequires:  golang(github.com/oschwald/maxminddb-golang)

%if %{with check}
# Tests
BuildRequires:  golang(github.com/stretchr/testify/assert)
BuildRequires:  golang(github.com/stretchr/testify/require)
%endif

%description
%{common_description}

%gopkg

%prep
%goprep
# extract test data to the right location
pushd test-data
tar -xzf %{SOURCE1}
mv MaxMind-DB-%{dataref}/* ./
rm -r MaxMind-DB-%{dataref}
popd

%install
%gopkginstall

%if %{with check}
%check
%gocheck
%endif

%gopkgfiles

%changelog
%autochangelog
