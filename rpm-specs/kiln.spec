# Generated by go2rpm 1.3
%bcond_without check

# https://git.sr.ht/~adnano/kiln
%global goipath         git.sr.ht/~adnano/kiln
%global forgeurl        https://git.sr.ht/~adnano/kiln
Version:                0.4.0
%global tag             0.4.0
%global repo            kiln
%global archivename     %{repo}-%{tag}
%global archiveext      tar.gz
%global archiveurl      %{forgeurl}/archive/%{tag}.%{archiveext}
%global topdir          %{repo}-%{tag}
%global extractdir      %{repo}-%{tag}
%global scm             git

%gometa

%global common_description %{expand:
A simple static site generator.

Features
 - Simple
 - Extensible
 - Gemini support
 - Atom feeds
 - Go templates}

Name:           kiln
Release:        %autorelease
Summary:        Simple static site generator.

License:        MIT
URL:            %{gourl}
Source0:        %{gosource}
# Disable building of kiln that we handle manually in the SPEC
Patch0:         kiln-fix-makefile.patch

BuildRequires:  scdoc

%description
%{common_description}

%prep
%goprep
%patch -P0 -p1

%generate_buildrequires
%go_generate_buildrequires

%build
export LDFLAGS="-X main.Version=%{version} "
%gobuild -o %{gobuilddir}/bin/%{name} %{goipath}
%make_build docs

%install
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/
export PREFIX=%{_prefix}
%make_install

%if %{with check}
%check
%gocheck
%endif

%files
%license COPYING
%doc config.toml README.md
%{_bindir}/%{name}
%{_mandir}/man1/%{name}.1*

%changelog
%autochangelog
