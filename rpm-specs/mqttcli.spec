# Generated by go2rpm 1.9.0
%bcond_without check

# https://git.sr.ht/~spc/mqttcli
%global goipath         git.sr.ht/~spc/mqttcli
%global forgeurl        https://git.sr.ht/~spc/mqttcli
Version:                0.2.5
%global tag             %{version}

%gometa -f

%global common_description %{expand:
mqttcli provides two programs (pub and sub) that allow command-line access to an
MQTT broker.

sub subscribes to a topic and prints messages received to standard output.
pub publishes the provided message to the provided topic. Both programs
accept flags that can be provided as a config file.}

%global golicenses      LICENSE
%global godocs          README.md

Name:           mqttcli
Release:        %autorelease
Summary:        Simple MQTT CLI pub/sub client

License:        GPL-3.0-only
URL:            %{gourl}
Source:         %{gosource}

BuildRequires:  /usr/bin/a2x

%description
%{common_description}

%gopkg

%prep
%goprep
%autopatch -p1

%generate_buildrequires
%go_generate_buildrequires

%build
%gobuild -o %{gobuilddir}/bin/pub %{goipath}/cmd/pub
%gobuild -o %{gobuilddir}/bin/sub %{goipath}/cmd/sub
a2x --doctype manpage --format manpage --destination-dir %{gobuilddir} doc/sub.adoc
a2x --doctype manpage --format manpage --destination-dir %{gobuilddir} doc/pub.adoc

%install
install -m 0755 -vd                       %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/pub %{buildroot}%{_bindir}/pub
install -m 0755 -vp %{gobuilddir}/bin/sub %{buildroot}%{_bindir}/sub
install -m 0755 -vd                       %{buildroot}%{_mandir}/man1
install -m 0644 -vp %{gobuilddir}/sub.1   %{buildroot}%{_mandir}/man1/sub.1
install -m 0644 -vp %{gobuilddir}/pub.1   %{buildroot}%{_mandir}/man1/pub.1


%if %{with check}
%check
%gocheck
%endif

%files
%license LICENSE
%doc README.md
%{_bindir}/*
%{_mandir}/man1

%changelog
%autochangelog
